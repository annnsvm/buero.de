# Інструменти та технології проєкту

Повний список tools: що використовуємо офіційно в проєкті, для чого та чому обрали. Опційні інструменти — в кінці (розділ 11).

---

## 1. Backend: фреймворк та runtime

### Node.js

- **Що робить:** середовище виконання JavaScript/TypeScript на сервері.
- **У проєкті:** основа бекенду; NestJS та всі пакети працюють поверх Node.
- **Чому обрали:** типова основа для NestJS, велика екосистема, одна мова з фронтом при потребі.

### NestJS

- **Що робить:** backend-фреймворк на TypeScript з модульною архітектурою, dependency injection, вбудованою підтримкою guards, pipes, interceptors.
- **У проєкті:** структура API (модулі Auth, Users, Courses, Course Materials, Progress & Quizzes, Subscriptions, Lesson Requests), контролери, сервіси, захист ендпоінтів за роллю.
- **Чому обрали:** чітка структура для великого API, вбудована інтеграція з Passport (JWT), Swagger, validation; зручно масштабувати та підтримувати.

---

## 2. База даних та ORM

### PostgreSQL

- **Що робить:** реляційна СУБД; зберігання users, courses, course_materials, subscriptions, progress, refresh_tokens тощо.
- **У проєкті:** єдине сховище даних (architecture.md); всі таблиці та зв’язки описані в архітектурі.
- **Чому обрали:** надійність, JSON/JSONB для content матеріалів і сценаріїв, підтримка enum, UUID; без Redis у MVP.

### Prisma

- **Що робить:** ORM для Node: схема в `schema.prisma`, типобезпечні клієнти, міграції, seed.
- **У проєкті:** доступ до БД у всіх сервісах (UserService, CourseService, CourseMaterialService, Stripe webhook handler тощо); міграції для змін схеми.
- **Чому обрали:** типобезпека з TypeScript, зручний API, міграції з коробки, добра інтеграція з NestJS (PrismaService).

---

## 3. Авторизація та безпека

### JWT (JSON Web Tokens)

- **Що робить:** підписані токени (access + refresh) для безстатевої аутентифікації; payload містить user id, role, exp.
- **У проєкті:** access token (TTL 30 хв) для доступу до API; refresh token (7 днів) зберігається в БД для ротації та revoke при logout (auth-spec.md).
- **Чому обрали:** стандартний підхід для SPA/API; cookie-based передача токенів (без XSS-експозиції в тілі відповіді).

### @nestjs/jwt

- **Що робить:** модуль NestJS для підпису та верифікації JWT (генерація access/refresh, перевірка підпису та exp).
- **У проєкті:** генерація пари токенів при register/login/refresh; валідація access у guard.
- **Чому обрали:** офіційна інтеграція з NestJS, мінімум коду для sign/verify.

### Passport + @nestjs/passport + passport-jwt

- **Що робить:** стратегії аутентифікації; JWT strategy витягує токен з cookie або заголовка `Authorization: Bearer` і валідує його.
- **У проєкті:** глобальний або маршрутний JwtAuthGuard; отримання `user` з payload для захищених ендпоінтів; можливість окремого RolesGuard (student/teacher).
- **Чому обрали:** де-факто стандарт для Node auth; NestJS має готові пакети під Passport.

### bcrypt (або bcryptjs)

- **Що робить:** хешування паролів з сіллю; перевірка пароля при логіні.
- **У проєкті:** збереження `password_hash` при реєстрації; порівняння при login (auth-spec, architecture).
- **Чому обрали:** рекомендований для паролів; в архітектурі явно зазначено bcrypt. (Альтернатива: argon2 — сильніший, але bcrypt достатній для MVP.)

### cookie-parser (або вбудований у NestJS)

- **Що робить:** парсинг cookie з запиту для читання `access_token` / `refresh_token`.
- **У проєкті:** токени передаються в cookie; Passport JWT strategy читає токен з cookie або з заголовка.
- **Чому обрали:** відповідає auth-spec (токени в cookie, не в JSON body).

### @nestjs/throttler

- **Що робить:** rate limiting для HTTP-запитів (обмеження кількості запитів за період по IP або по користувачу).
- **У проєкті:** захист від брутфорсу на login/register; опційно глобальний ліміт для всього API.
- **Чому обрали:** офіційний модуль NestJS; мінімум налаштувань; покращує безпеку без зовнішніх сервісів.

---

## 4. Валідація та DTO

### class-validator

- **Що робить:** декоратори для валідації полів класу (IsEmail, IsString, MinLength, IsUUID, IsEnum тощо).
- **У проєкті:** DTO для register, login, створення/оновлення курсів і матеріалів, відповіді квізів, webhook payload; перехоплення помилок валідації та повернення 400 з читабельними повідомленнями.
- **Чому обрали:** ідіоматично для NestJS; ValidationPipe викликає валідатори перед входом у контролер.

### class-transformer

- **Що робить:** перетворення plain object → class instance (для class-validator), прибирання полів (@Exclude), перетворення типів (@Type).
- **У проєкті:** DTO як класи; прибрати з response поля на кшталт password_hash; перетворення query/body у правильні типи (наприклад number для order_index).
- **Чому обрали:** використовується разом з class-validator у Nest; контроль над тим, що повертаємо клієнту.

---

## 5. Документація API

### Swagger (OpenAPI) — @nestjs/swagger

- **Що робить:** генерація OpenAPI-спеки та інтерактивної документації (Swagger UI) з декораторів на контролерах і DTO.
- **У проєкті:** опис всіх ендпоінтів (Auth, Users, Courses, Materials, Progress, Subscriptions, Lesson Requests), схеми request/response, авторизація (Bearer/cookie) для тестування з браузера.
- **Чому обрали:** один джерело правди для API; фронт/партнери можуть використовувати спеку; зручно тестувати без Postman під час розробки.

---

## 6. Зовнішні API та SDK

### YouTube (Data API v3 / embed)

- **Що робить:** отримання метаданих відео (опційно: тривалість, thumbnail, title) або лише вбудовування по video_id (iframe).
- **У проєкті:** матеріали типу video зберігають `youtube_video_id` (04-course-materials); фронт показує embed; при потребі бекенд може валідувати існування відео або підтягувати метадані через API (опційно).
- **Чому обрали:** відео хостимо на YouTube (MVP); API потрібен для валідації або метаданих, embed — без обов’язкового API виклику.

### Stripe SDK (stripe)

- **Що робить:** створення Checkout Session, Customer Portal URL, верифікація webhook signature, робота з subscription/payment objects.
- **У проєкті:** Subscriptions & Billing (06-subscriptions-billing): checkout, portal, обробка webhook (checkout.session.completed, invoice.paid, customer.subscription.updated/deleted); ідемпотентність через stripe_webhook_events.
- **Чому обрали:** офіційний клієнт; без нього неможливо безпечно обробляти webhook та створювати сесії (architecture, Stripe в компонентах).

---

## 7. Тестування

### Jest

- **Що робить:** тест-ранер та assertion-бібліотека для unit- та інтеграційних тестів (describe, it, expect, mocks).
- **У проєкті:** unit-тести сервісів (UserService, CourseMaterialService, Stripe webhook handler тощо), інтеграційні тести контролерів з мокованою БД або тестовою БД.
- **Чому обрали:** стандарт для NestJS; вбудована підтримка у CLI (nest g app з Jest); швидкі тести, snapshot при потребі.

### Supertest

- **Що робить:** HTTP-запити до NestJS-додатку в пам’яті (без реального мережевого слухання).
- **У проєкті:** e2e-тести ендпоінтів: register → login → доступ до /api/courses тощо; перевірка статус-кодів та тіла відповіді.
- **Чому обрали:** офіційно рекомендований у документації NestJS для e2e; зручно тестувати cookie та заголовки.

---

## 8. Конфігурація та середовище

### @nestjs/config

- **Що робить:** завантаження змінних середовища з `.env`; ConfigService для доступу до значень у модулях.
- **У проєкті:** JWT_SECRET, DATABASE_URL, STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET, порт сервера, frontend URL для CORS/cookie.
- **Чому обрали:** вбудована підтримка в Nest; уникнення хардкоду секретів; можливість валідації env при старті (наприклад через Joi).

---

## 8.1. Локалізація (i18n)

### nestjs-i18n (або прості JSON-файли)

- **Що робить:** підтримка кількох мов для повідомлень API (помилки валідації, тексти листів, повідомлення).
- **У проєкті:** мови інтерфейсу EN/DE (architecture); повідомлення про помилки та відповіді API у мові користувача (за заголовком Accept-Language або профілем).
- **Чому обрали:** архітектура передбачає EN/DE; nestjs-i18n інтегрується з Nest; для MVP достатньо простих JSON-файлів з перекладами.

---

## 9. Розробка та операції

### TypeScript

- **Що робить:** типізована надбудова над JavaScript; компіляція в JS.
- **У проєкті:** весь бекенд на TS; типи для DTO, Prisma-моделей, сервісів; менше помилок на ранті.
- **Чому обрали:** NestJS і Prisma орієнтовані на TypeScript; узгодженість з архітектурою та підтримкою.

### Git

- **Що робить:** система контролю версій (гілки, коміти, merge).
- **У проєкті:** версіонування коду, code review, інтеграція з CI при потребі.
- **Чому обрали:** стандарт індустрії.

### VSCode (або Cursor)

- **Що робить:** редактор коду з підтримкою TypeScript, дебагу, інтеграцією з Git.
- **У проєкті:** основне середовище розробки.
- **Чому обрали:** зручність, плагіни для Nest/Prisma/ESLint.

### Docker

- **Що робить:** контейнеризація: образ з Node, залежностями та додатком; опційно docker-compose для PostgreSQL + API.
- **У проєкті:** однакове середовище для розробки та деплою; локальний PostgreSQL у контейнері; спрощення онбордингу.
- **Чому обрали:** повторюваність середовища; згадано в поточному tools.md.

### Postman (або аналог)

- **Що робить:** ручне тестування API (колекції запитів, змінні, cookie).
- **У проєкті:** перевірка ендпоінтів під час розробки; можна частково замінити Swagger UI для складних сценаріїв (наприклад cookie + refresh).
- **Чому обрали:** згадано в поточному списку; зручно для швидких перевірок.

### Stripe CLI

- **Що робить:** CLI для роботи з Stripe; команда `stripe listen --forward-to localhost:3000/webhooks/stripe` прокладає webhook-и на локальний сервер.
- **У проєкті:** локальне тестування обробки webhook (checkout.session.completed, invoice.paid, subscription.updated тощо) без деплою.
- **Чому обрали:** офіційний інструмент Stripe; необхідний для безпечної розробки Subscriptions & Billing.

### ESLint + Prettier

- **Що робить:** ESLint — перевірка стилю та помилок коду; Prettier — автоматичне форматування (відступи, лапки, переноси).
- **У проєкті:** єдиний стиль коду в репозиторії; форматування при збереженні або в pre-commit; Nest часто включає їх за замовчуванням.
- **Чому обрали:** зменшення шумових дифів на рев’ю; узгодженість між розробниками.

---

## 10. Процес та співпраця

### Scrum (Agile)

- **Що робить:** ітеративна розробка, спринти, беклог, ретро.
- **У проєкті:** організація роботи команди та планування фіч (модулі з api-plan, docs/modules).
- **Чому обрали:** вже прийнято в проєкті.

### Jira

- **Що робить:** беклог, задачі, спринти, трекінг багів.
- **У проєкті:** фіксація задач за модулями (Auth, Users, Placement, Courses тощо), пріоритизація.
- **Чому обрали:** вже в списку інструментів.

### Telegram

- **Що робить:** комунікація, сповіщення, обмін посиланнями.
- **У проєкті:** координація команди; опційно боти для нотифікацій (наприклад про помилки) — не обов’язково в MVP.
- **Чому обрали:** вже в списку.

### Figma

- **Що робить:** дизайн інтерфейсів, прототипи, передача макетів фронту.
- **У проєкті:** макети landing, кабінетів студента/вчителя, курсів, квізів.
- **Чому обрали:** вже в списку.

### Google Analytics (або аналог)

- **Що робить:** збір аналітики по відвідувачах, подіях, конверсіях.
- **У проєкті:** аналіз використання платформи (опційно в MVP); підключення на фронті.
- **Чому обрали:** вже в списку.

### Clean Code, Code Reviews, Refactoring, Continuous Testing

- **Що робить:** практики якості коду (читабельність, тести, рев’ю перед merge).
- **У проєкті:** підтримка якості бекенду та фронту; тести (Jest/Supertest) як частина процесу.
- **Чому обрали:** вже зафіксовані в проєкті.

### Md files / Documentation as Code

- **Що робить:** документація в репозиторії (docs/, README); оновлення разом з кодом.
- **У проєкті:** architecture.md, api-plan.md, auth-spec.md, docs/modules/*.md, tools.md — єдине джерело правди для архітектури та API.
- **Чому обрали:** вже в списку; узгоджено з поточною структурою docs.

---

## 11. Короткий чеклист «що не забути»

- **JWT:** @nestjs/jwt + Passport (passport-jwt) + збереження refresh у Postgres з revoke при logout.
- **Валідація:** class-validator + class-transformer + ValidationPipe.
- **Документація API:** Swagger (@nestjs/swagger).
- **БД:** PostgreSQL + Prisma (міграції, PrismaService у Nest).
- **Зовнішні сервіси:** Stripe SDK (checkout, webhook, portal); YouTube — embed по video_id, опційно Data API для метаданих.
- **Тести:** Jest для unit/інтеграції; Supertest для e2e.
- **Конфіг:** .env + @nestjs/config; не зберігати секрети в репозиторії.
- **Cookie:** cookie-parser або вбудована підтримка Nest для читання access_token/refresh_token.
- **Rate limit:** @nestjs/throttler для login/register та API.
- **Локалізація:** nestjs-i18n або JSON для EN/DE.
- **Розробка:** Stripe CLI для webhook; ESLint + Prettier для стилю коду.

Якщо потрібно, можна винести цей чеклист у окремий файл або в README бекенду.
